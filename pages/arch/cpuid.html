<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CPUID 0x1 Feature Flags – ECX & EDX</title>
  <style>
    :root {
      --gap: .4rem;
      --bit-size: 46px;
      --radius: 10px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; padding: 1rem 1rem 2.5rem; font-family: var(--font);
      background: #0b0d10; color: #e8eef6; line-height: 1.35;
    }
    h1 { font-size: clamp(1.2rem, 2.3vw, 1.8rem); margin: 0 0 .6rem; }
    p, label { color: #c9d6e6; }
    .wrap { max-width: 1200px; margin: 0 auto; }

    .panel {
      background: #11161c; border: 1px solid #1c2531; box-shadow: 0 10px 30px rgba(0,0,0,.25);
      padding: 1rem; border-radius: 16px; margin-block: 1rem;
    }
    .panel h2 { font-size: 1.05rem; margin: 0 0 .6rem; color: #cfe1ff; }

    .inputs { display: grid; gap: .6rem; grid-template-columns: 1fr; }
    @media (min-width: 750px) { .inputs { grid-template-columns: 1fr 1fr; } }

    .field { display: grid; gap: .35rem; }
    .field input {
      background: #0e1318; border: 1px solid #2a3543; color: #e8eef6; padding: .6rem .7rem;
      border-radius: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 0.95rem;
    }
    .hint { font-size: .85rem; opacity: .8; }

    .legend { display: flex; gap: .75rem; align-items: center; flex-wrap: wrap; margin-top: .5rem; }
    .pill { padding: .25rem .5rem; border-radius: 999px; font-size: .8rem; border: 1px solid #2a3543; }
    .pill.is-set { background: #15351c; border-color: #275c32; color: #b7f5c1; }
    .pill.is-clear { background: #31191b; border-color: #5a2a2f; color: #ffc0c7; }

    .reg {
      display: grid; gap: var(--gap);
      grid-template-columns: repeat(32, minmax(30px, 1fr));
      overflow-x: auto; padding-bottom: .5rem;
    }

    .bit {
      position: relative; min-width: var(--bit-size); min-height: var(--bit-size);
      background: #0e1318; border: 1px solid #243040; border-radius: var(--radius);
      display: grid; place-items: center; text-align: center; padding: .2rem;
      cursor: default; transition: transform .06s ease;
    }
    .bit:hover { transform: translateY(-1px); }
    .bit .idx { position: absolute; top: 4px; left: 6px; font-size: .68rem; color: #93a6bf; opacity: .85; }
    .bit .name { font-size: .78rem; font-weight: 600; letter-spacing: .01em; color: #cfe1ff; }
    .bit .desc { display: none; }

    .bit.set { background: #16301d; border-color: #2b5e3b; box-shadow: inset 0 0 0 1px rgba(103, 232, 121, .15); }
    .bit.set .name { color: #b9f6c3; }

    .bit.clear { background: #1a0f12; border-color: #4a2830; box-shadow: inset 0 0 0 1px rgba(244, 114, 182, .07); }
    .bit.clear .name { color: #ffc1cb; opacity: .9; }

    .rowtitle { margin: .25rem 0 .6rem; color: #9db5d3; font-weight: 700; letter-spacing: .02em; }

    .note { font-size: .85rem; color: #a9bad1; }
    .footer { margin-top: 1rem; font-size: .8rem; color: #7c8ea7; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: .82rem; background: #0e1318; padding: .15rem .35rem; border-radius: 6px; border: 1px solid #2a3543; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CPUID <span class="kbd">EAX=0x1</span> – Feature Flags in <span class="kbd">ECX</span> and <span class="kbd">EDX</span></h1>
    <p class="note">Enter the values you read from <span class="kbd">ECX</span> and <span class="kbd">EDX</span> after executing <span class="kbd">CPUID</span> with <span class="kbd">EAX=0x1</span>. The diagram highlights set bits (<strong>green</strong>) and names each feature. Bits are ordered <strong>31 → 0</strong> (left to right).</p>

    <div class="panel inputs">
      <div class="field">
        <label for="ecxIn">ECX value (hex like <span class="kbd">0x1f0</span>, dec, or bin like <span class="kbd">0b1010</span>)</label>
        <input id="ecxIn" placeholder="e.g., 0x7fbae3ff" />
        <div class="hint">Common: <span class="kbd">SSE3</span>, <span class="kbd">PCLMULQDQ</span>, <span class="kbd">SSSE3</span>, <span class="kbd">SSE4.1</span>, <span class="kbd">SSE4.2</span>, <span class="kbd">AES</span>, <span class="kbd">XSAVE/OSXSAVE</span>, <span class="kbd">AVX</span>, <span class="kbd">F16C</span>, <span class="kbd">RDRAND</span>, <span class="kbd">HYPERVISOR</span>.</div>
      </div>
      <div class="field">
        <label for="edxIn">EDX value (hex/dec/bin)</label>
        <input id="edxIn" placeholder="e.g., 0xbfebfbff" />
        <div class="hint">Classic: <span class="kbd">FPU</span>, <span class="kbd">TSC</span>, <span class="kbd">MSR</span>, <span class="kbd">PAE</span>, <span class="kbd">CMOV</span>, <span class="kbd">MMX</span>, <span class="kbd">SSE/SSE2</span>, <span class="kbd">HTT</span>.</div>
      </div>
      <div class="legend">
        <span class="pill is-set">bit = 1 (feature present)</span>
        <span class="pill is-clear">bit = 0 (feature absent)</span>
      </div>
    </div>

    <div class="panel">
      <div class="rowtitle">ECX (bits 31…0)</div>
      <div class="reg" id="ecx"></div>
    </div>

    <div class="panel">
      <div class="rowtitle">EDX (bits 31…0)</div>
      <div class="reg" id="edx"></div>
    </div>

    <div class="footer">Tip: Paste raw register values from your debugger. Parsing accepts <span class="kbd">0x..</span>, <span class="kbd">0b..</span>, or decimal.</div>
  </div>

  <script>
    // --- Feature maps for CPUID EAX=0x1 ---
    // Names kept short for the boxes; descriptions appear in the title tooltip.
    const FEATURES = {
      ecx: {
        31: ["HYPERVISOR", "Hypervisor present (running under a VMM)"],
        30: ["RDRAND", "RDRAND instruction"],
        29: ["F16C", "16-bit FP conversions (F16C)"],
        28: ["AVX", "Advanced Vector Extensions"],
        27: ["OSXSAVE", "OS has enabled XSAVE/XRSTOR"],
        26: ["XSAVE", "XSAVE/XRSTOR/XSETBV/XGETBV"],
        25: ["AES", "AES-NI instructions"],
        24: ["TSC-DL", "APIC TSC-deadline timer"],
        23: ["POPCNT", "POPCNT instruction"],
        22: ["MOVBE", "MOVBE instruction"],
        21: ["x2APIC", "x2APIC support"],
        20: ["SSE4.2", "Streaming SIMD Extensions 4.2"],
        19: ["SSE4.1", "Streaming SIMD Extensions 4.1"],
        18: ["DCA", "Direct Cache Access"],
        17: ["PCID", "Process-context identifiers"],
        16: ["RES", "Reserved"],
        15: ["PDCM", "Perf/Debug Capability MSR"],
        14: ["xTPR", "xTPR update control"],
        13: ["CX16", "CMPXCHG16B instruction"],
        12: ["FMA", "Fused Multiply-Add (FMA)"],
        11: ["SDBG", "Silicon Debug (enumeration)"],
        10: ["CNXT-ID", "L1 context ID"],
        9:  ["SSSE3", "Supplemental SSE3"],
        8:  ["TM2", "Thermal Monitor 2"],
        7:  ["EIST", "Enhanced Intel SpeedStep Technology"],
        6:  ["SMX", "Safer Mode Extensions (TXT)"],
        5:  ["VMX", "Virtual Machine Extensions"],
        4:  ["DS-CPL", "CPL qualified debug store"],
        3:  ["MONITOR", "MONITOR/MWAIT"],
        2:  ["DTES64", "64-bit debug store (trace)"],
        1:  ["PCLMULQDQ", "Carryless multiply (CLMUL)"],
        0:  ["SSE3", "Streaming SIMD Extensions 3"],
      },
      edx: {
        31: ["PBE", "Pending Break Enable"],
        30: ["IA64", "IA-64 capability (Itanium indicator)"],
        29: ["TM", "Thermal Monitor"],
        28: ["HTT", "Hyper-Threading Technology"],
        27: ["SS", "Self-Snoop"],
        26: ["SSE2", "Streaming SIMD Extensions 2"],
        25: ["SSE", "Streaming SIMD Extensions"],
        24: ["FXSR", "FXSAVE/FXRSTOR"],
        23: ["MMX", "MMX technology"],
        22: ["ACPI", "Thermal Monitor & Clock Control"],
        21: ["DS", "Debug Store"],
        20: ["RES", "Reserved"],
        19: ["CLFSH", "CLFLUSH instruction"],
        18: ["PSN", "Processor Serial Number"],
        17: ["PSE36", "36-bit Page Size Extension"],
        16: ["PAT", "Page Attribute Table"],
        15: ["CMOV", "Conditional Move/FCMOV/FCOMI"],
        14: ["MCA", "Machine Check Architecture"],
        13: ["PGE", "Page Global Enable"],
        12: ["MTRR", "Memory Type Range Registers"],
        11: ["SEP", "SYSENTER/SYSEXIT"],
        10: ["RES", "Reserved"],
        9:  ["APIC", "On-chip APIC"],
        8:  ["CX8", "CMPXCHG8B instruction"],
        7:  ["MCE", "Machine Check Exception"],
        6:  ["PAE", "Physical Address Extension"],
        5:  ["MSR", "Model Specific Registers"],
        4:  ["TSC", "Time Stamp Counter"],
        3:  ["PSE", "Page Size Extension (4 MiB)"],
        2:  ["DE",  "Debugging Extensions"],
        1:  ["VME", "Virtual 8086 Mode Enhancements"],
        0:  ["FPU", "x87 FPU on chip"],
      }
    };

    function parseVal(str) {
      if (!str) return 0 >>> 0;
      const s = str.trim().toLowerCase();
      try {
        if (s.startsWith('0x')) return Number.parseInt(s, 16) >>> 0;
        if (s.startsWith('0b')) return Number.parseInt(s.slice(2), 2) >>> 0;
        if (/^[0-9]+$/.test(s)) return Number.parseInt(s, 10) >>> 0;
        return 0 >>> 0;
      } catch { return 0 >>> 0; }
    }

    function bitSet(val, bit) { return ((val >>> bit) & 1) === 1; }

    function makeBitEl(bit, type, val) {
      const [name, desc] = (FEATURES[type][bit] || ["RES", "Reserved"]);
      const el = document.createElement('div');
      el.className = 'bit ' + (bitSet(val, bit) ? 'set' : 'clear');
      el.title = `bit ${bit}: ${name}\n${desc}`;
      el.innerHTML = `<span class="idx">${bit}</span><span class="name">${name}</span>`;
      return el;
    }

    function render(type, val) {
      const host = document.getElementById(type);
      host.innerHTML = '';
      for (let bit = 31; bit >= 0; bit--) host.appendChild(makeBitEl(bit, type, val));
    }

    // Default values stay empty (all zero) until the user pastes.
    render('ecx', 0);
    render('edx', 0);

    const ecxIn = document.getElementById('ecxIn');
    const edxIn = document.getElementById('edxIn');

    const update = () => {
      render('ecx', parseVal(ecxIn.value));
      render('edx', parseVal(edxIn.value));
    };

    ecxIn.addEventListener('input', update);
    edxIn.addEventListener('input', update);

    // Provide a handy demo value when users paste nothing and press Enter
    function maybeDemo(e) {
      if (e.key === 'Enter' && !e.target.value.trim()) {
        if (e.target === ecxIn) ecxIn.value = '0x7ffafbff';
        if (e.target === edxIn) edxIn.value = '0xbfebfbff';
        update();
      }
    }
    ecxIn.addEventListener('keydown', maybeDemo);
    edxIn.addEventListener('keydown', maybeDemo);
  </script>
</body>
</html>
